// OpenAI client configuration for AI chatbot
import OpenAI from 'openai';
import { findBestMatch, detectProductRecommendation, getProductRecommendation } from './patternMatcher';
import { KNOWLEDGE_BASE } from './knowledgeBase';

if (!process.env.OPENAI_API_KEY) {
    console.warn('âš ï¸ OPENAI_API_KEY not found. Using demo mode.');
}

export const openai = new OpenAI({
    apiKey: process.env.OPENAI_API_KEY || 'dummy-key',
});

// System prompt for Al-Awad - The Honey Expe rt
export const SYSTEM_PROMPT = `Ø£Ù†Øª Ø§Ù„Ø¹ÙˆØ§Ø¯ ðŸØŒ Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù…ØªØ®ØµØµ ÙÙŠ Ø§Ù„Ø¹Ø³Ù„ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ Ø§Ù„Ù…ØºØ±Ø¨ÙŠ Ù„Ù…ØªØ¬Ø± "Ø¹Ø³Ù„ ØªØ§Ø±ÙˆØ¯Ø§Ù†Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠ".

**Ø´Ø®ØµÙŠØªÙƒ:**
- Ø§Ø³Ù…Ùƒ: Ø§Ù„Ø¹ÙˆØ§Ø¯ (Ø§Ù„Ù†Ø­Ø§Ù„ Ø§Ù„Ù…ØºØ±Ø¨ÙŠ)
- ÙˆØ¯ÙˆØ¯ØŒ Ù…Ø±Ø­ØŒ ÙˆØ·ÙŠØ¨ Ø§Ù„Ù‚Ù„Ø¨
- Ø®Ø¨ÙŠØ± ÙÙŠ Ø§Ù„Ø¹Ø³Ù„ ÙˆÙÙˆØ§Ø¦Ø¯Ù‡
- ØªØªÙƒÙ„Ù… Ø¨Ø§Ù„Ø¯Ø§Ø±Ø¬Ø© Ø§Ù„Ù…ØºØ±Ø¨ÙŠØ© Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø·Ø¨ÙŠØ¹ÙŠØ©
- ØªØ­Ø¨ ØªØ³Ø§Ø¹Ø¯ Ø§Ù„Ù†Ø§Ø³ ÙˆØªÙ†ØµØ­Ù‡Ù…

**Ù…Ù†ØªØ¬Ø§ØªÙ†Ø§:**
1. Ø¹Ø³Ù„ Ø§Ù„Ø²Ø¹ØªØ± (150 Ø¯Ø±Ù‡Ù…) - ÙˆØ§Ø¹Ø± Ù„Ù„Ø³Ø¹Ø§Ù„ ÙˆØ§Ù„Ù…Ù†Ø§Ø¹Ø© ðŸŒ¿
2. Ø¹Ø³Ù„ Ø§Ù„Ø£ÙˆÙƒØ§Ù„Ø¨ØªÙˆØ³ (180 Ø¯Ø±Ù‡Ù…) - Ø²ÙˆÙŠÙ† Ù„Ù„Ø¨Ø±Ø¯ ÙˆØ§Ù„ØµØ¯Ø± ðŸŒ²
3. Ø¹Ø³Ù„ Ø§Ù„Ø£ÙƒØ§Ø³ÙŠØ§ (120 Ø¯Ø±Ù‡Ù…) - Ø®ÙÙŠÙ ÙˆÙ…Ø²ÙŠØ§Ù† Ù„Ù„Ø¯Ø±Ø§Ø±ÙŠ ðŸ‘¶
4. Ø¹Ø³Ù„ Ø§Ù„Ø²Ù‡ÙˆØ± (100 Ø¯Ø±Ù‡Ù…) - Ø·Ø¨ÙŠØ¹ÙŠ 100% Ù„Ù„Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ø§Ù„ÙŠÙˆÙ…ÙŠ ðŸŒ¸
5. Ø¹Ø³Ù„ Ø§Ù„Ø³Ø¯Ø± (250 Ø¯Ø±Ù‡Ù…) - ÙØ§Ø®Ø± ÙˆØºÙ†ÙŠ Ø¨Ø§Ù„ÙÙˆØ§Ø¦Ø¯ ðŸŒŸ
6. Ø¹Ø³Ù„ Ø§Ù„Ù…Ø§Ù†ÙˆÙƒØ§ (300 Ø¯Ø±Ù‡Ù…) - Ù‚ÙˆÙŠ Ø¶Ø¯ Ø§Ù„Ø¨ÙƒØªÙŠØ±ÙŠØ§ ðŸ’ª

**Ø£Ø³Ù„ÙˆØ¨Ùƒ ÙÙŠ Ø§Ù„ÙƒÙ„Ø§Ù…:**
- Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¯Ø§Ø±Ø¬Ø© Ø§Ù„Ù…ØºØ±Ø¨ÙŠØ© Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ (ÙˆØ§Ø¹Ø±ØŒ Ø²ÙˆÙŠÙ†ØŒ Ù…Ø²ÙŠØ§Ù†ØŒ Ø§Ù„Ø¯Ø±Ø§Ø±ÙŠ...)
- ÙƒÙ† ÙˆØ¯ÙˆØ¯Ø§Ù‹ ÙˆÙ…Ø±Ø­Ø§Ù‹
- Ø£Ø¶Ù emojis Ù…Ù†Ø§Ø³Ø¨Ø© ðŸðŸ¯
- Ø§Ø´Ø±Ø­ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø³ÙŠØ·Ø© ÙˆÙˆØ§Ø¶Ø­Ø©
- ÙƒÙ† Ù…Ø®ØªØµØ±Ø§Ù‹ (3-4 Ø¬Ù…Ù„ ÙÙ‚Ø·)

**Ù…Ù‡Ù…ØªÙƒ:**
- Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø²Ø¨Ø§Ø¦Ù† ÙŠØ®ØªØ§Ø±Ùˆ Ø§Ù„Ø¹Ø³Ù„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
- Ø§Ù‚ØªØ±Ø­ Ù…Ù†ØªØ¬Ø§Øª Ø­Ø³Ø¨ Ø§Ø­ØªÙŠØ§Ø¬Ø§ØªÙ‡Ù…
- Ø¬Ø§ÙˆØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ø·Ø±ÙŠÙ‚Ø© ÙˆØ¯ÙŠØ©
- Ø´Ø§Ø±Ùƒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ÙÙŠØ¯Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ§Ø¦Ø¯

**Ø£Ù…Ø«Ù„Ø© Ø¹Ù„Ù‰ Ø·Ø±ÙŠÙ‚Ø© ÙƒÙ„Ø§Ù…Ùƒ:**
- "Ø§Ù„Ø³Ù„Ø§Ù…! Ø£Ù†Ø§ Ø§Ù„Ø¹ÙˆØ§Ø¯ØŒ Ø®Ø¨ÙŠØ± Ø§Ù„Ø¹Ø³Ù„ Ø¯ÙŠØ§Ù„ÙƒÙ… ðŸ"
- "Ù‡Ø§Ø¯Ø§ Ø§Ù„Ø¹Ø³Ù„ ÙˆØ§Ø¹Ø± Ø¨Ø²Ø§Ù Ù„Ù„Ø³Ø¹Ø§Ù„!"
- "Ø¨Ø§Ù„ØµØ­Ø© ÙˆØ§Ù„Ø±Ø§Ø­Ø©! ðŸ¯"

ØªØ°ÙƒØ±: Ø£Ù†Øª Ø§Ù„Ø¹ÙˆØ§Ø¯ - ØµØ¯ÙŠÙ‚ Ø§Ù„Ø²Ø¨ÙˆÙ† ÙˆØ®Ø¨ÙŠØ±Ù‡ ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø¹Ø³Ù„!`;

// Intelligent response using Knowledge Base
function getIntelligentResponse(message, conversationHistory = [], context = '') {
    const lowerMessage = message.toLowerCase();

    // --- PAGE CONTEXT AWARENESS ---
    if (context) {
        // Cart Page
        if (context.includes('cart') && (lowerMessage.includes('Ù…Ø³Ø§Ø¹Ø¯Ø©') || lowerMessage.includes('Ø¹Ø§ÙˆÙ†ÙŠ') || lowerMessage.includes('Ø´Ù†Ùˆ'))) {
            return {
                content: 'ðŸ›’ Ø£Ù†Ø§ Ù…Ø¹Ø§Ùƒ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø³Ù„Ø©!\n\nÙˆØ§Ø´ Ù…Ø­ØªØ§Ø¬ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¨Ø§Ø´ ØªÙƒÙ…Ù„ Ø§Ù„Ø·Ù„Ø¨ØŸ ÙˆÙ„Ø§ Ø¨ØºÙŠØªÙŠ ØªØ²ÙŠØ¯ Ø´ÙŠ Ø­Ø§Ø¬Ø© Ø£Ø®Ø±Ù‰ØŸ ðŸ¯'
            };
        }

        // Checkout Page
        if (context.includes('checkout') && (lowerMessage.includes('Ø¯ÙØ¹') || lowerMessage.includes('Ù…Ø´ÙƒÙ„') || lowerMessage.includes('ÙƒÙŠÙØ§Ø´'))) {
            return {
                content: 'ðŸ’³ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹:\n\nâœ… ÙƒÙ†Ù‚Ø¨Ù„Ùˆ Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…\nâœ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù„Ø¥Ù…Ø§Ø±Ø§Øª\n\nÙˆØ§Ø´ Ø¹Ù†Ø¯Ùƒ Ø´ÙŠ Ù…Ø´ÙƒÙ„ ÙÙŠ ØªØ¹Ù…Ø§Ø± Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªØŸ'
            };
        }

        // Product Page (generic)
        if (context.includes('products') && (lowerMessage.includes('Ù†ØµØ­Ù†ÙŠ') || lowerMessage.includes('Ø±Ø§ÙŠ') || lowerMessage.includes('ÙƒÙŠÙØ§Ø´'))) {
            return {
                content: 'ðŸ¯ Ø£Ù†Ø§ ÙƒÙ†Ø´ÙˆÙÙƒ ÙƒØªÙ‚Ù„Ø¨ ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª!\n\nÙ‡Ø§Ø¯ Ø§Ù„Ø¹Ø³Ù„ Ù…Ù…ØªØ§Ø²ØŒ ÙˆÙ„ÙƒÙ† Ù‚ÙˆÙ„ Ù„ÙŠØ§ Ø´Ù†Ùˆ Ø§Ù„Ø­Ø§Ø¬Ø© Ø§Ù„Ù„ÙŠ ÙƒØªÙ‚Ù„Ø¨ Ø¹Ù„ÙŠÙ‡Ø§ Ø¨Ø§Ù„Ø¶Ø¨Ø·ØŸ (Ø³Ø¹Ø§Ù„ØŒ Ù…Ù†Ø§Ø¹Ø©ØŒ Ø·Ø§Ù‚Ø©...)'
            };
        }
    }

    // Get last AI message for context
    const lastAiMessage = conversationHistory.length > 0
        ? conversationHistory[conversationHistory.length - 1].content
        : '';

    // --- CONTEXT AWARE RESPONSES ---

    // 1. Cough/Cold Context
    if (lastAiMessage.includes('Ù†Ø§Ø´ÙØ© ÙˆÙ„Ø§ Ø¹Ø§Ù…Ø±Ø©')) {
        if (lowerMessage.includes('Ù†Ø§Ø´ÙØ©')) {
            return {
                content: 'ðŸ¯ Ø§Ù„ÙƒØ­Ø© Ø§Ù„Ù†Ø§Ø´ÙØ© (Jaff) Ø®Ø§ØµÙ‡Ø§ Ø´ÙŠ Ø­Ø§Ø¬Ø© ØªØ±Ø·Ø¨ Ø§Ù„Ø­Ù„Ù‚.\n\nðŸŒ¿ **Ø¹Ø³Ù„ Ø§Ù„Ø²Ø¹ØªØ±** Ù‡Ùˆ Ø£Ø­Ø³Ù† Ø§Ø®ØªÙŠØ§Ø±!\nâœ… ÙƒÙŠÙ‡Ø¯Ù† Ø§Ù„Ø­Ù„Ù‚\nâœ… Ù…Ø¶Ø§Ø¯ Ù„Ù„Ø¬Ø±Ø§Ø«ÙŠÙ…\n\nÙˆØ§Ø´ Ø¨ØºÙŠØªÙŠ Ù†Ø²ÙŠØ¯ Ù„ÙŠÙƒ Ù‚Ø±ÙŠØ¹Ø©ØŸ'
            };
        } else if (lowerMessage.includes('Ø¹Ø§Ù…Ø±Ø©') || lowerMessage.includes('Ø®Ø§ÙˆÙŠØ©')) {
            return {
                content: 'ðŸ¯ Ø§Ù„ÙƒØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø±Ø© Ø®Ø§ØµÙ‡Ø§ Ø´ÙŠ Ø­Ø§Ø¬Ø© ØªØ³Ø±Ø­ Ø§Ù„ØµØ¯Ø±.\n\nðŸŒ² **Ø¹Ø³Ù„ Ø§Ù„Ø£ÙˆÙƒØ§Ù„Ø¨ØªÙˆØ³** Ø¯Ù‚Ø© Ø¨Ø·Ù„Ø©!\nâœ… ÙƒÙŠÙˆØ³Ø¹ Ø§Ù„Ø´Ø¹Ø¨ Ø§Ù„Ù‡ÙˆØ§Ø¦ÙŠØ©\nâœ… ÙƒÙŠÙ†Ù‚ÙŠ Ø§Ù„ØµØ¯Ø±\n\nÙˆØ§Ø´ Ù†Ø¬ÙŠØ¨ Ù„ÙŠÙƒ ÙˆØ­Ø¯Ø© ØªØ¬Ø±Ø¨Ù‡Ø§ØŸ'
            };
        }
    }

    // 2. Fatigue Context
    if (lastAiMessage.includes('Ù„Ù„Ø±ÙŠØ§Ø¶Ø© ÙˆÙ„Ø§ ØºÙŠØ± Ù„Ù„Ø­ÙŠØ§Ø©')) {
        if (lowerMessage.includes('Ø±ÙŠØ§Ø¶Ø©') || lowerMessage.includes('Ø³Ø¨ÙˆØ±')) {
            return {
                content: 'ðŸ’ª Ù„Ù„Ø±ÙŠØ§Ø¶ÙŠÙŠÙ†ØŒ ÙƒÙ†ØµØ­Ùƒ Ø¨Ù€ **Ø¹Ø³Ù„ Ø§Ù„Ø³Ø¯Ø±**!\n\nðŸŒŸ ÙƒÙŠØ¹Ø·ÙŠ Ø·Ø§Ù‚Ø© Ù‚ÙˆÙŠØ© ÙˆÙ…Ø³ØªØ¯Ø§Ù…Ø©\nðŸ§¬ ØºÙ†ÙŠ Ø¨Ø§Ù„Ù…Ø¹Ø§Ø¯Ù†\n\nÙ‡Ø§Ø¯Ø§ Ù‡Ùˆ Ø³Ø± Ø§Ù„Ø£Ø¨Ø·Ø§Ù„! ðŸ‹ï¸â€â™‚ï¸'
            };
        } else {
            return {
                content: 'ðŸŒ¸ Ù„Ù„Ø­ÙŠØ§Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ÙˆØ§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø®ÙÙŠÙØ©ØŒ **Ø¹Ø³Ù„ Ø§Ù„Ø²Ù‡ÙˆØ±** Ø£Ùˆ **Ø§Ù„Ø£ÙƒØ§Ø³ÙŠØ§** Ù…Ù…ØªØ§Ø²ÙŠÙ†.\n\nâœ¨ Ø®ÙØ§Ù Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø¯Ø© ÙˆÙƒÙŠØ¹Ø·ÙŠÙˆ Ù†Ø´Ø§Ø· Ø·Ø¨ÙŠØ¹ÙŠ Ù„Ù„ÙØ·ÙˆØ±.\n\nØ¨Ø§Ø´ Ø¨ØºÙŠØªÙŠ ØªØ¨Ø¯Ø§ Ù†Ù‡Ø§Ø±ÙƒØŸ â˜€ï¸'
            };
        }
    }

    // 3. Stomach Context
    if (lastAiMessage.includes('Ø­Ù…ÙˆØ¶Ø© (Ø­Ø±Ù‚Ø§Ù†) ÙˆÙ„Ø§ ØºÙŠØ± Ø¹Ø³Ø± Ù‡Ø¶Ù…')) {
        if (lowerMessage.includes('Ø­Ù…ÙˆØ¶Ø©') || lowerMessage.includes('Ø­Ø±Ù‚Ø§Ù†')) {
            return {
                content: 'ðŸ”¥ Ù„Ù„Ø­Ù…ÙˆØ¶Ø© ÙˆØ­Ø±Ù‚Ø§Ù† Ø§Ù„Ù…Ø¹Ø¯Ø©ØŒ **Ø¹Ø³Ù„ Ø§Ù„Ø³Ø¯Ø±** Ù…Ù…ØªØ§Ø² Ø¨Ø²Ø§Ù.\n\nðŸ›¡ï¸ ÙƒÙŠØ¯ÙŠØ± Ø·Ø¨Ù‚Ø© Ø­Ø§Ù…ÙŠØ© Ù„Ù„Ù…Ø¹Ø¯Ø© ÙˆÙƒÙŠÙ†Ù‚Øµ Ø§Ù„Ø­Ù…ÙˆØ¶Ø©.\n\nØ§Ù„Ù„Ù‡ ÙŠØ´Ø§ÙÙŠÙƒ ÙˆÙŠØ¹Ø§ÙÙŠÙƒ! â¤ï¸'
            };
        } else if (lowerMessage.includes('Ø¹Ø³Ø±') || lowerMessage.includes('Ù‡Ø¶Ù…') || lowerMessage.includes('Ø«Ù‚Ù„')) {
            return {
                content: 'ðŸŒ¿ Ù„Ø¹Ø³Ø± Ø§Ù„Ù‡Ø¶Ù… ÙˆØ§Ù„Ø§Ù†ØªÙØ§Ø®ØŒ **Ø¹Ø³Ù„ Ø§Ù„Ø²Ø¹ØªØ±** Ù‡Ùˆ Ø§Ù„Ø­Ù„.\n\nâœ¨ ÙƒÙŠØ³Ù‡Ù„ Ø§Ù„Ù‡Ø¶Ù… ÙˆÙƒÙŠØ­ÙŠØ¯ Ø§Ù„ØºØ§Ø²Ø§Øª.\n\nØ¬Ø±Ø¨Ùˆ Ù…Ø¹ ÙƒØ§Ø³ Ù…Ø§Ø¡ Ø¯Ø§ÙÙŠ ÙÙŠ Ø§Ù„ØµØ¨Ø§Ø­! â˜•'
            };
        }
    }

    // --- DIRECT DIAGNOSIS TRIGGERS ---

    // Cough/Cold Trigger
    if (lowerMessage.includes('Ø³Ø¹Ø§Ù„') || lowerMessage.includes('ÙƒØ­Ø©') || lowerMessage.includes('ØµØ¯Ø±') || lowerMessage.includes('Ù…Ø±ÙŠØ¶')) {
        return {
            content: 'ðŸ˜· ÙŠØ§ Ø±Ø¨ÙŠ Ø§Ù„Ø³Ù„Ø§Ù…Ø©! Ø§Ù„Ù„Ù‡ ÙŠØ¬ÙŠØ¨ Ø§Ù„Ø´ÙØ§Ø¡ Ø§Ù„Ø¹Ø§Ø¬Ù„.\n\nØ¨Ø§Ø´ Ù†Ù†ØµØ­Ùƒ Ø¨Ø§Ù„Ø¹Ø³Ù„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ØŒ Ù‚ÙˆÙ„ Ù„ÙŠØ§:\nâ“ ÙˆØ§Ø´ Ø§Ù„ÙƒØ­Ø© **Ù†Ø§Ø´ÙØ©** ÙˆÙ„Ø§ **Ø¹Ø§Ù…Ø±Ø©** (Ø®Ø§ÙˆÙŠØ©)ØŸ'
        };
    }

    // Fatigue Trigger
    if (lowerMessage.includes('Ø¹ÙŠØ§Ø¡') || lowerMessage.includes('Ø¹ÙŠØ§Ù†') || lowerMessage.includes('Ø³Ø®ÙØ©') || lowerMessage.includes('Ø·Ø§Ù‚Ø©') || lowerMessage.includes('ÙØ§Ø´Ù„')) {
        return {
            content: 'ðŸ”‹ Ø§Ù„Ù„Ù‡ ÙŠÙ‚ÙˆÙŠÙƒ! Ø§Ù„Ø¹Ø³Ù„ Ù‡Ùˆ Ø£Ø­Ø³Ù† Ù…ØµØ¯Ø± Ù„Ù„Ø·Ø§Ù‚Ø©.\n\nÙˆÙ„ÙƒÙ† Ù‚ÙˆÙ„ Ù„ÙŠØ§:\nâ“ ÙˆØ§Ø´ Ø¨ØºÙŠØªÙŠ Ø§Ù„Ø·Ø§Ù‚Ø© **Ù„Ù„Ø±ÙŠØ§Ø¶Ø©** ðŸ‹ï¸â€â™‚ï¸ ÙˆÙ„Ø§ ØºÙŠØ± **Ù„Ù„Ø­ÙŠØ§Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©** ÙˆØ§Ù„Ø®Ø¯Ù…Ø©ØŸ ðŸ’¼'
        };
    }

    // Stomach Trigger
    if (lowerMessage.includes('Ù…Ø¹Ø¯Ø©') || lowerMessage.includes('Ù‡Ø¶Ù…') || lowerMessage.includes('ÙƒØ±Ø´ÙŠ') || lowerMessage.includes('Ø­Ø±Ù‚Ø§Ù†')) {
        return {
            content: 'ðŸ©º Ø§Ù„Ù„Ù‡ ÙŠØ´Ø§ÙÙŠÙƒ. Ø§Ù„Ù…Ø¹Ø¯Ø© Ù‡ÙŠ Ø¨ÙŠØª Ø§Ù„Ø¯Ø§Ø¡ ÙˆØ§Ù„Ø¯ÙˆØ§Ø¡.\n\nØ¨Ø§Ø´ Ù†Ø¹Ø·ÙŠÙƒ Ø§Ù„Ø£Ø­Ø³Ù†ØŒ ÙˆØ§Ø´ ÙƒØªØ­Ø³ Ø¨Ù€ **Ø­Ù…ÙˆØ¶Ø© (Ø­Ø±Ù‚Ø§Ù†)** ðŸ”¥ ÙˆÙ„Ø§ ØºÙŠØ± **Ø¹Ø³Ø± Ù‡Ø¶Ù…** ÙˆØ«Ù‚Ù„ØŸ ðŸ§±'
        };
    }

    // Greetings
    if (lowerMessage.includes('Ø³Ù„Ø§Ù…') || lowerMessage.includes('Ù…Ø±Ø­Ø¨Ø§') || lowerMessage.includes('ØµØ¨Ø§Ø­') || lowerMessage.includes('Ù…Ø³Ø§Ø¡')) {
        return {
            content: 'ðŸ Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…! Ø£Ù†Ø§ Ø§Ù„Ø¹ÙˆØ§Ø¯ØŒ Ø®Ø¨ÙŠØ± Ø§Ù„Ø¹Ø³Ù„ Ø¯ÙŠØ§Ù„ÙƒÙ…!\n\nÙƒÙŠÙØ§Ø´ Ù†Ù‚Ø¯Ø± Ù†Ø¹Ø§ÙˆÙ†Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ ðŸ¯'
        };
    }

    // How are you (including Ù„Ø¨Ø³ Ø¹Ù„ÙŠÙƒ)
    if (lowerMessage.includes('ÙƒØ¯Ø§ÙŠØ±') || lowerMessage.includes('ÙƒÙŠØ¯Ø§ÙŠØ±') || lowerMessage.includes('Ù„Ø§Ø¨Ø§Ø³') || lowerMessage.includes('Ø¨Ø®ÙŠØ±') || lowerMessage.includes('Ù„Ø¨Ø³ Ø¹Ù„ÙŠÙƒ') || lowerMessage.includes('Ù„Ø§Ø¨Ø³ Ø¹Ù„ÙŠÙƒ')) {
        return {
            content: 'ðŸ Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ØŒ Ø¨Ø®ÙŠØ± ÙˆÙƒÙ†Ø®Ø¯Ù…!\n\nÙƒÙ†Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù†Ø§Ø³ ÙŠØ®ØªØ§Ø±Ùˆ Ø§Ù„Ø¹Ø³Ù„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„ÙŠÙ‡Ù… ðŸ¯\n\nÙˆØ£Ù†ØªØŒ Ù„Ø§Ø¨Ø³ Ø¹Ù„ÙŠÙƒØŸ ÙƒÙŠÙØ§Ø´ Ù†Ù‚Ø¯Ø± Ù†Ø¹Ø§ÙˆÙ†ÙƒØŸ'
        };
    }

    // Who are you
    if (lowerMessage.includes('Ø´ÙƒÙˆÙ†') || lowerMessage.includes('Ù…Ù† Ø§Ù†Øª') || lowerMessage.includes('ÙˆØ§Ø´ Ø§Ù†Øª')) {
        return {
            content: 'ðŸ Ø£Ù†Ø§ Ø§Ù„Ø¹ÙˆØ§Ø¯ - Ø§Ù„Ù†Ø­Ø§Ù„ Ø§Ù„Ù…ØºØ±Ø¨ÙŠ!\n\nâœ¨ Ø®Ø¨ÙŠØ± ÙÙŠ Ø§Ù„Ø¹Ø³Ù„ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ\nðŸ¯ ÙƒÙ†Ø³Ø§Ø¹Ø¯Ùƒ ØªØ®ØªØ§Ø± Ø§Ù„Ø¹Ø³Ù„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨\nðŸ’š ØµØ¯ÙŠÙ‚Ùƒ ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø¹Ø³Ù„\n\nÙƒÙŠÙØ§Ø´ Ù†Ù‚Ø¯Ø± Ù†Ø¹Ø§ÙˆÙ†Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ'
        };
    }

    // What are you doing
    if (lowerMessage.includes('Ø§Ø´ ÙƒØ¯ÙŠØ±') || lowerMessage.includes('Ø´Ù†Ùˆ ÙƒØ¯ÙŠØ±') || lowerMessage.includes('ÙˆØ§Ø´ ÙƒØªØ¯ÙŠØ±')) {
        return {
            content: 'ðŸ ÙƒÙ†Ø®Ø¯Ù…! ÙƒÙ†Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù†Ø§Ø³ ÙŠØ¹Ø±ÙÙˆ Ø§Ù„Ø¹Ø³Ù„ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ\n\nâœ¨ ÙƒÙ†Ø¬Ø§ÙˆØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©\nðŸ¯ ÙƒÙ†Ù‚ØªØ±Ø­ Ø£Ø­Ø³Ù† Ø§Ù„Ø£Ù†ÙˆØ§Ø¹\nðŸ’¡ ÙƒÙ†Ø´Ø§Ø±Ùƒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ÙÙŠØ¯Ø©\n\nÙ‚ÙˆÙ„ Ù„ÙŠØ§ØŒ ÙˆØ§Ø´ Ø¨ØºÙŠØªÙŠ ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø³Ù„ØŸ'
        };
    }

    // Thanks
    if (lowerMessage.includes('Ø´ÙƒØ±Ø§') || lowerMessage.includes('Ø¨Ø§Ø±Ùƒ') || lowerMessage.includes('Ù…Ø±Ø³ÙŠ') || lowerMessage.includes('ØªØ³Ù„Ù…')) {
        return {
            content: 'ðŸ Ø¨Ø§Ù„ØµØ­Ø© ÙˆØ§Ù„Ø±Ø§Ø­Ø©!\n\nØ£ÙŠ ÙˆÙ‚Øª ØªØ­ØªØ§Ø¬ Ù…Ø³Ø§Ø¹Ø¯Ø©ØŒ Ø£Ù†Ø§ Ù‡Ù†Ø§! ðŸ¯\n\nØ¨Ø§Ù„ØªÙˆÙÙŠÙ‚! âœ¨'
        };
    }

    // Goodbye
    if (lowerMessage.includes('Ø¨Ø³Ù„Ø§Ù…Ø©') || lowerMessage.includes('Ø¨Ø§ÙŠ') || lowerMessage.includes('Ù†Ø´ÙˆÙÙƒ') || lowerMessage.includes('ÙˆØ¯Ø§Ø¹')) {
        return {
            content: 'ðŸ Ø¨Ø³Ù„Ø§Ù…Ø©! Ø§Ù„Ù„Ù‡ ÙŠØ­ÙØ¸Ùƒ\n\nÙ†Ø´ÙˆÙÙƒ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰! ðŸ¯\n\nÙ…Ø§ ØªÙ†Ø³Ø§Ø´ØŒ Ø§Ù„Ø¹Ø³Ù„ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ = ØµØ­Ø© ÙˆØ¹Ø§ÙÙŠØ©! âœ¨'
        };
    }

    // Product types
    if (lowerMessage.includes('Ø£Ù†ÙˆØ§Ø¹') || lowerMessage.includes('Ø§Ù†ÙˆØ§Ø¹')) {
        return {
            content: 'ðŸ¯ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ø³Ù„ Ø¹Ù†Ø¯Ù†Ø§:\n\n1ï¸âƒ£ Ø¹Ø³Ù„ Ø§Ù„Ø²Ø¹ØªØ± (150 Ø¯Ø±Ù‡Ù…) - ÙˆØ§Ø¹Ø± Ù„Ù„Ø³Ø¹Ø§Ù„ ÙˆØ§Ù„Ù…Ù†Ø§Ø¹Ø© ðŸŒ¿\n2ï¸âƒ£ Ø¹Ø³Ù„ Ø§Ù„Ø£ÙˆÙƒØ§Ù„Ø¨ØªÙˆØ³ (180 Ø¯Ø±Ù‡Ù…) - Ø²ÙˆÙŠÙ† Ù„Ù„Ø¨Ø±Ø¯ ÙˆØ§Ù„ØµØ¯Ø± ðŸŒ²\n3ï¸âƒ£ Ø¹Ø³Ù„ Ø§Ù„Ø£ÙƒØ§Ø³ÙŠØ§ (120 Ø¯Ø±Ù‡Ù…) - Ø®ÙÙŠÙ ÙˆÙ…Ø²ÙŠØ§Ù† Ù„Ù„Ø¯Ø±Ø§Ø±ÙŠ ðŸ‘¶\n4ï¸âƒ£ Ø¹Ø³Ù„ Ø§Ù„Ø²Ù‡ÙˆØ± (100 Ø¯Ø±Ù‡Ù…) - Ø·Ø¨ÙŠØ¹ÙŠ 100% ðŸŒ¸\n5ï¸âƒ£ Ø¹Ø³Ù„ Ø§Ù„Ø³Ø¯Ø± (250 Ø¯Ø±Ù‡Ù…) - ÙØ§Ø®Ø± ÙˆØºÙ†ÙŠ Ø¨Ø§Ù„ÙÙˆØ§Ø¦Ø¯ ðŸŒŸ\n6ï¸âƒ£ Ø¹Ø³Ù„ Ø§Ù„Ù…Ø§Ù†ÙˆÙƒØ§ (300 Ø¯Ø±Ù‡Ù…) - Ù‚ÙˆÙŠ Ø¶Ø¯ Ø§Ù„Ø¨ÙƒØªÙŠØ±ÙŠØ§ ðŸ’ª\n\nðŸ’¡ Ù‚ÙˆÙ„ Ù„ÙŠØ§ Ø¹Ù„Ù‰ Ø£ÙŠ ÙˆØ§Ø­Ø¯ Ø¨ØºÙŠØªÙŠ ØªØ¹Ø±Ù Ø£ÙƒØ«Ø±!'
        };
    }

    // What do you have
    if (lowerMessage.includes('Ø¹Ù†Ø¯ÙƒÙ…') || lowerMessage.includes('Ø¹Ù†Ø¯Ùƒ')) {
        return {
            content: 'ðŸ¯ Ø¹Ù†Ø¯Ù†Ø§ 6 Ø£Ù†ÙˆØ§Ø¹ Ù…Ù† Ø§Ù„Ø¹Ø³Ù„ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ:\n\n1ï¸âƒ£ Ø¹Ø³Ù„ Ø§Ù„Ø²Ø¹ØªØ± - Ù„Ù„Ø³Ø¹Ø§Ù„ ÙˆØ§Ù„Ù…Ù†Ø§Ø¹Ø©\n2ï¸âƒ£ Ø¹Ø³Ù„ Ø§Ù„Ø£ÙˆÙƒØ§Ù„Ø¨ØªÙˆØ³ - Ù„Ù„Ø¨Ø±Ø¯ ÙˆØ§Ù„ØµØ¯Ø±\n3ï¸âƒ£ Ø¹Ø³Ù„ Ø§Ù„Ø£ÙƒØ§Ø³ÙŠØ§ - Ù„Ù„Ø£Ø·ÙØ§Ù„\n4ï¸âƒ£ Ø¹Ø³Ù„ Ø§Ù„Ø²Ù‡ÙˆØ± - Ù„Ù„Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ø§Ù„ÙŠÙˆÙ…ÙŠ\n5ï¸âƒ£ Ø¹Ø³Ù„ Ø§Ù„Ø³Ø¯Ø± - ÙØ§Ø®Ø±\n6ï¸âƒ£ Ø¹Ø³Ù„ Ø§Ù„Ù…Ø§Ù†ÙˆÙƒØ§ - Ø¹Ù„Ø§Ø¬ÙŠ\n\nðŸ’¡ Ù‚ÙˆÙ„ Ù„ÙŠØ§ Ø¹Ù„Ù‰ Ø£ÙŠ ÙˆØ§Ø­Ø¯ Ø¨ØºÙŠØªÙŠ ØªØ¹Ø±Ù Ø£ÙƒØ«Ø±!'
        };
    }

    // General questions
    if (lowerMessage.includes('Ø£Ø³Ø¦Ù„Ø©')) {
        return {
            content: 'â“ Ø£Ø³Ø¦Ù„Ø© Ø´Ø§Ø¦Ø¹Ø©:\n\nðŸ¯ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ø³Ù„\nðŸ’¡ ÙÙˆØ§Ø¦Ø¯ Ø§Ù„Ø¹Ø³Ù„\nðŸ“– ÙˆØµÙØ§Øª Ø¨Ø§Ù„Ø¹Ø³Ù„\nðŸ›’ ÙƒÙŠÙØ§Ø´ Ù†Ø´Ø±ÙŠ\nðŸ’° Ø§Ù„Ø£Ø³Ø¹Ø§Ø±\nðŸ‘¶ Ø¹Ø³Ù„ Ù„Ù„Ø£Ø·ÙØ§Ù„\nðŸ¤§ Ø¹Ø³Ù„ Ù„Ù„Ø³Ø¹Ø§Ù„\n\nðŸ’¬ Ù‚ÙˆÙ„ Ù„ÙŠØ§ Ø¹Ù„Ù‰ Ø£ÙŠ Ù…ÙˆØ¶ÙˆØ¹!'
        };
    }

    // How to buy
    if (lowerMessage.includes('Ø´Ø±ÙŠ') || lowerMessage.includes('Ø·Ù„Ø¨') || lowerMessage.includes('Ø§Ø´ØªØ±ÙŠ')) {
        return {
            content: 'ðŸ›’ ÙƒÙŠÙØ§Ø´ ØªØ´Ø±ÙŠ Ø§Ù„Ø¹Ø³Ù„:\n\n1ï¸âƒ£ Ø§Ø®ØªØ§Ø± Ø§Ù„Ù†ÙˆØ¹ Ù„ÙŠ Ø¨ØºÙŠØªÙŠ\n2ï¸âƒ£ Ø²ÙŠØ¯ Ù„Ù„Ø¹Ø±Ø¨Ø© ðŸ›’\n3ï¸âƒ£ Ø£ÙƒÙ…Ù„ Ø§Ù„Ø·Ù„Ø¨\n4ï¸âƒ£ Ø§Ø®ØªØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹\n\nâœ… Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…\nâœ… Ø¨Ø·Ø§Ù‚Ø© Ø¨Ù†ÙƒÙŠØ©\nðŸšš ØªÙˆØµÙŠÙ„ Ù„Ø¬Ù…ÙŠØ¹ Ø£Ù†Ø­Ø§Ø¡ Ø§Ù„Ù…ØºØ±Ø¨ (2-3 Ø£ÙŠØ§Ù…)\n\nðŸ“ž Ø£Ùˆ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ø§Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©!'
        };
    }

    // Benefits
    if (lowerMessage.includes('ÙÙˆØ§Ø¦Ø¯') || lowerMessage.includes('ÙØ§ÙŠØ¯Ø©')) {
        return {
            content: 'ðŸ’¡ ÙÙˆØ§Ø¦Ø¯ Ø§Ù„Ø¹Ø³Ù„ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ:\n\nâœ… ÙŠÙ‚ÙˆÙŠ Ø§Ù„Ù…Ù†Ø§Ø¹Ø©\nâœ… ÙŠØ¹Ø§Ù„Ø¬ Ø§Ù„Ø³Ø¹Ø§Ù„ ÙˆØ§Ù„Ø¨Ø±Ø¯\nâœ… ÙŠØ­Ø³Ù† Ø§Ù„Ù‡Ø¶Ù…\nâœ… ÙŠØ¹Ø·ÙŠ Ø·Ø§Ù‚Ø© Ø·Ø¨ÙŠØ¹ÙŠØ©\nâœ… Ù…ÙÙŠØ¯ Ù„Ù„Ø¨Ø´Ø±Ø©\nâœ… ÙŠØ³Ø§Ø¹Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙˆÙ…\nâœ… ÙŠØ¹Ø§Ù„Ø¬ Ø§Ù„Ø¬Ø±ÙˆØ­\nâœ… Ù…Ø¶Ø§Ø¯ Ù„Ù„Ø£ÙƒØ³Ø¯Ø©\n\nðŸ Ø§Ù„Ø¹Ø³Ù„ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ = ØµÙŠØ¯Ù„ÙŠØ© Ø·Ø¨ÙŠØ¹ÙŠØ©!'
        };
    }

    // Recipes
    if (lowerMessage.includes('ÙˆØµÙØ©') || lowerMessage.includes('ÙˆØµÙØ§Øª')) {
        return {
            content: 'ðŸ“– ÙˆØµÙØ§Øª Ø³Ø±ÙŠØ¹Ø© Ø¨Ø§Ù„Ø¹Ø³Ù„:\n\n1ï¸âƒ£ Ù…Ø´Ø±ÙˆØ¨ Ø§Ù„Ø·Ø§Ù‚Ø©: Ø¹Ø³Ù„ + Ù„ÙŠÙ…ÙˆÙ† + Ù…Ø§Ø¡ Ø¯Ø§ÙØ¦\n2ï¸âƒ£ Ø­Ù„ÙŠØ¨ Ø¨Ø§Ù„Ø¹Ø³Ù„: Ø­Ù„ÙŠØ¨ Ø¯Ø§ÙØ¦ + Ù…Ù„Ø¹Ù‚Ø© Ø¹Ø³Ù„ (Ù„Ù„Ù†ÙˆÙ…)\n3ï¸âƒ£ Ø³Ù…ÙˆØ°ÙŠ: Ù…ÙˆØ² + Ø¹Ø³Ù„ + Ø­Ù„ÙŠØ¨\n4ï¸âƒ£ Ù‚Ù†Ø§Ø¹ Ø§Ù„Ø¨Ø´Ø±Ø©: Ø¹Ø³Ù„ + Ù„ÙŠÙ…ÙˆÙ† (15 Ø¯Ù‚ÙŠÙ‚Ø©)\n5ï¸âƒ£ Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø³Ø¹Ø§Ù„: Ø¹Ø³Ù„ + Ø²Ù†Ø¬Ø¨ÙŠÙ„ + Ù„ÙŠÙ…ÙˆÙ†\n\nðŸ’¡ Ø¨ØºÙŠØªÙŠ ÙˆØµÙØ© Ù…Ø¹ÙŠÙ†Ø©ØŸ Ù‚ÙˆÙ„ Ù„ÙŠØ§!'
        };
    }

    // Prices
    if (lowerMessage.includes('Ø³Ø¹Ø±') || lowerMessage.includes('Ø«Ù…Ù†') || lowerMessage.includes('Ø´Ø­Ø§Ù„')) {
        return {
            content: 'ðŸ’° Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø¹Ø³Ù„ Ø¯ÙŠØ§Ù„Ù†Ø§:\n\nðŸ¯ Ø¹Ø³Ù„ Ø§Ù„Ø²Ù‡ÙˆØ±: 100 Ø¯Ø±Ù‡Ù…\nðŸ¯ Ø¹Ø³Ù„ Ø§Ù„Ø£ÙƒØ§Ø³ÙŠØ§: 120 Ø¯Ø±Ù‡Ù…\nðŸ¯ Ø¹Ø³Ù„ Ø§Ù„Ø²Ø¹ØªØ±: 150 Ø¯Ø±Ù‡Ù…\nðŸ¯ Ø¹Ø³Ù„ Ø§Ù„Ø£ÙˆÙƒØ§Ù„Ø¨ØªÙˆØ³: 180 Ø¯Ø±Ù‡Ù…\nðŸ¯ Ø¹Ø³Ù„ Ø§Ù„Ø³Ø¯Ø±: 250 Ø¯Ø±Ù‡Ù…\nðŸ¯ Ø¹Ø³Ù„ Ø§Ù„Ù…Ø§Ù†ÙˆÙƒØ§: 300 Ø¯Ø±Ù‡Ù…\n\nâœ¨ ÙƒÙ„Ù‡Ù… Ø·Ø¨ÙŠØ¹ÙŠÙŠÙ† 100%!'
        };
    }

    // For children
    if (lowerMessage.includes('Ø·ÙÙ„') || lowerMessage.includes('Ø£Ø·ÙØ§Ù„') || lowerMessage.includes('Ø¯Ø±Ø§Ø±') || lowerMessage.includes('ØµØºÙŠØ±')) {
        return {
            content: 'ðŸ‘¶ Ø§Ù„Ø¹Ø³Ù„ Ù„Ù„Ø£Ø·ÙØ§Ù„:\n\nâš ï¸ Ù…Ù…Ù†ÙˆØ¹ Ù„Ù„Ø£Ø·ÙØ§Ù„ Ø£Ù‚Ù„ Ù…Ù† Ø³Ù†Ø©!\nâœ… Ù…Ù† Ø³Ù†Ø© ÙÙ…Ø§ ÙÙˆÙ‚: Ø¢Ù…Ù† ÙˆÙ…ÙÙŠØ¯\n\nðŸ¯ Ø£Ø­Ø³Ù† Ù†ÙˆØ¹: Ø¹Ø³Ù„ Ø§Ù„Ø£ÙƒØ§Ø³ÙŠØ§ (120 Ø¯Ø±Ù‡Ù…)\nâœ¨ Ø®ÙÙŠÙ ÙˆÙ…Ø²ÙŠØ§Ù† Ù„Ù„Ø¯Ø±Ø§Ø±ÙŠ\n\nðŸ’¡ ÙŠØ¹Ø·ÙŠ Ø·Ø§Ù‚Ø© ÙˆÙŠÙ‚ÙˆÙŠ Ø§Ù„Ù…Ù†Ø§Ø¹Ø©!'
        };
    }

    // For cough/cold
    if (lowerMessage.includes('Ø³Ø¹Ø§Ù„') || lowerMessage.includes('ÙƒØ­Ø©') || lowerMessage.includes('Ø¨Ø±Ø¯')) {
        return {
            content: 'ðŸ¤§ Ø§Ù„Ø¹Ø³Ù„ Ù„Ù„Ø³Ø¹Ø§Ù„ ÙˆØ§Ù„Ø¨Ø±Ø¯:\n\nðŸŒ¿ Ø¹Ø³Ù„ Ø§Ù„Ø²Ø¹ØªØ± (150 Ø¯Ø±Ù‡Ù…)\nâœ¨ ÙˆØ§Ø¹Ø± Ø¨Ø²Ø§Ù Ù„Ù„Ø³Ø¹Ø§Ù„!\n\nðŸŒ² Ø¹Ø³Ù„ Ø§Ù„Ø£ÙˆÙƒØ§Ù„Ø¨ØªÙˆØ³ (180 Ø¯Ø±Ù‡Ù…)\nâœ¨ Ø²ÙˆÙŠÙ† Ù„Ù„Ø¨Ø±Ø¯ ÙˆØ§Ù„ØµØ¯Ø±\n\nðŸ’¡ Ø¬Ø±Ø¨Ùˆ ÙˆØºØ§Ø¯ÙŠ ØªØ´ÙˆÙÙˆ Ø§Ù„ÙØ±Ù‚!'
        };
    }

    // Product recommendation
    if (detectProductRecommendation(message)) {
        const product = getProductRecommendation(message);
        return {
            content: `ðŸ¯ ${product.name}\n\nðŸ’° Ø§Ù„Ø³Ø¹Ø±: ${product.price} Ø¯Ø±Ù‡Ù…\nâœ¨ ${product.description}\n\nðŸ“ Ø§Ù„Ù…ØµØ¯Ø±: ${product.origin}\nðŸ’¡ Ø§Ù„Ø§Ø³ØªØ¹Ù…Ø§Ù„: ${product.usage}`,
            product: {
                id: Object.keys(KNOWLEDGE_BASE.products).indexOf(product.name) + 1,
                name: product.name,
                price: product.price,
                unit: 'Ø¯Ø±Ù‡Ù…',
                category: 'Ø¹Ø³Ù„ Ø·Ø¨ÙŠØ¹ÙŠ',
                rating: 4.8,
                imageUrl: `/images/${product.name.replace(/\s+/g, '-').toLowerCase()}.jpg`
            },
            buttons: [
                { type: 'add-to-cart', productId: Object.keys(KNOWLEDGE_BASE.products).indexOf(product.name) + 1, label: 'ðŸ›’ Ø²ÙŠØ¯ Ù„Ù„Ø¹Ø±Ø¨Ø©' },
                { type: 'view-product', productId: Object.keys(KNOWLEDGE_BASE.products).indexOf(product.name) + 1, label: 'ðŸ‘ï¸ Ø´ÙˆÙ Ø§Ù„Ù…Ù†ØªØ¬' }
            ]
        };
    }

    // Knowledge base match
    const match = findBestMatch(message);
    if (match && match.score > 0.3) {
        return { content: match.response };
    }

    // Fallback
    return { content: match.response };
}

export async function getAIResponse(userMessage, conversationHistory = [], context = '') {
    try {
        const messages = [
            { role: 'system', content: SYSTEM_PROMPT },
            ...conversationHistory.map(msg => ({
                role: msg.role === 'user' ? 'user' : 'assistant',
                content: msg.content
            })),
            { role: 'user', content: userMessage },
        ];

        const completion = await openai.chat.completions.create({
            model: 'gpt-3.5-turbo',
            messages: messages,
            temperature: 0.7,
            max_tokens: 200,
        });

        return { content: completion.choices[0].message.content };
    } catch (error) {
        console.error('OpenAI API Error:', error.message);
        return getIntelligentResponse(userMessage, conversationHistory, context);
    }
}
